###Linking ICD10 codes of interest to ICD10 dates###
#The input will be used to perform the observational and one-sample MR analyses restricted on ICD10 cases of interest that have occurred after the platelet measurements to minimise reverse causation.

##Prepare ICD10 codes of interest 
#Read in relevant packages
library(data.table)
library(plyr)
library(dplyr)

#Read in relevant data
dat <- fread("IEU_output_extracted_plateletphenotypes_SD_41270_ICD10_41280_ICD10dates.tsv", header = T, sep = " ", na.strings = c("","NA"))

#Format date columns to r dates 
dat$f.41280.0.0 <- as.Date(dat$f.41280.0.0)
dat$f.41280.0.1 <- as.Date(dat$f.41280.0.1)
dat$f.41280.0.2 <- as.Date(dat$f.41280.0.2)
dat$f.41280.0.3 <- as.Date(dat$f.41280.0.3)
dat$f.41280.0.4 <- as.Date(dat$f.41280.0.4)
dat$f.41280.0.5 <- as.Date(dat$f.41280.0.5)
dat$f.41280.0.6 <- as.Date(dat$f.41280.0.6)
dat$f.41280.0.7 <- as.Date(dat$f.41280.0.7)
dat$f.41280.0.8 <- as.Date(dat$f.41280.0.8)
dat$f.41280.0.9 <- as.Date(dat$f.41280.0.9)
dat$f.41280.0.10 <- as.Date(dat$f.41280.0.10)
dat$f.41280.0.11 <- as.Date(dat$f.41280.0.11)
dat$f.41280.0.12 <- as.Date(dat$f.41280.0.12)
dat$f.41280.0.13 <- as.Date(dat$f.41280.0.13)
dat$f.41280.0.14 <- as.Date(dat$f.41280.0.14)
dat$f.41280.0.15 <- as.Date(dat$f.41280.0.15)
dat$f.41280.0.16 <- as.Date(dat$f.41280.0.16)
dat$f.41280.0.17 <- as.Date(dat$f.41280.0.17)
dat$f.41280.0.18 <- as.Date(dat$f.41280.0.18)
dat$f.41280.0.19 <- as.Date(dat$f.41280.0.19)
dat$f.41280.0.20 <- as.Date(dat$f.41280.0.20)
dat$f.41280.0.21 <- as.Date(dat$f.41280.0.21)
dat$f.41280.0.22 <- as.Date(dat$f.41280.0.22)
dat$f.41280.0.23 <- as.Date(dat$f.41280.0.23)
dat$f.41280.0.24 <- as.Date(dat$f.41280.0.24)
dat$f.41280.0.25 <- as.Date(dat$f.41280.0.25)
dat$f.41280.0.26 <- as.Date(dat$f.41280.0.26)
dat$f.41280.0.27 <- as.Date(dat$f.41280.0.27)
dat$f.41280.0.28 <- as.Date(dat$f.41280.0.28)
dat$f.41280.0.29 <- as.Date(dat$f.41280.0.29)
dat$f.41280.0.30 <- as.Date(dat$f.41280.0.30)
dat$f.41280.0.31 <- as.Date(dat$f.41280.0.31)
dat$f.41280.0.32 <- as.Date(dat$f.41280.0.32)
dat$f.41280.0.33 <- as.Date(dat$f.41280.0.33)
dat$f.41280.0.34 <- as.Date(dat$f.41280.0.34)
dat$f.41280.0.35 <- as.Date(dat$f.41280.0.35)
dat$f.41280.0.36 <- as.Date(dat$f.41280.0.36)
dat$f.41280.0.37 <- as.Date(dat$f.41280.0.37)
dat$f.41280.0.38 <- as.Date(dat$f.41280.0.38)
dat$f.41280.0.39 <- as.Date(dat$f.41280.0.39)
dat$f.41280.0.40 <- as.Date(dat$f.41280.0.40)
dat$f.41280.0.41 <- as.Date(dat$f.41280.0.41)
dat$f.41280.0.42 <- as.Date(dat$f.41280.0.42)
dat$f.41280.0.43 <- as.Date(dat$f.41280.0.43)
dat$f.41280.0.44 <- as.Date(dat$f.41280.0.44)
dat$f.41280.0.45 <- as.Date(dat$f.41280.0.45)
dat$f.41280.0.46 <- as.Date(dat$f.41280.0.46)
dat$f.41280.0.47 <- as.Date(dat$f.41280.0.47)
dat$f.41280.0.48 <- as.Date(dat$f.41280.0.48)
dat$f.41280.0.49 <- as.Date(dat$f.41280.0.49)
dat$f.41280.0.50 <- as.Date(dat$f.41280.0.50)
dat$f.41280.0.51 <- as.Date(dat$f.41280.0.51)
dat$f.41280.0.52 <- as.Date(dat$f.41280.0.52)
dat$f.41280.0.53 <- as.Date(dat$f.41280.0.53)
dat$f.41280.0.54 <- as.Date(dat$f.41280.0.54)
dat$f.41280.0.55 <- as.Date(dat$f.41280.0.55)
dat$f.41280.0.56 <- as.Date(dat$f.41280.0.56)
dat$f.41280.0.57 <- as.Date(dat$f.41280.0.57)
dat$f.41280.0.58 <- as.Date(dat$f.41280.0.58)
dat$f.41280.0.59 <- as.Date(dat$f.41280.0.59)
dat$f.41280.0.60 <- as.Date(dat$f.41280.0.60)
dat$f.41280.0.61 <- as.Date(dat$f.41280.0.61)
dat$f.41280.0.62 <- as.Date(dat$f.41280.0.62)
dat$f.41280.0.63 <- as.Date(dat$f.41280.0.63)
dat$f.41280.0.64 <- as.Date(dat$f.41280.0.64)
dat$f.41280.0.65 <- as.Date(dat$f.41280.0.65)
dat$f.41280.0.66 <- as.Date(dat$f.41280.0.66)
dat$f.41280.0.67 <- as.Date(dat$f.41280.0.67)
dat$f.41280.0.68 <- as.Date(dat$f.41280.0.68)
dat$f.41280.0.69 <- as.Date(dat$f.41280.0.69)
dat$f.41280.0.70 <- as.Date(dat$f.41280.0.70)
dat$f.41280.0.71 <- as.Date(dat$f.41280.0.71)
dat$f.41280.0.72 <- as.Date(dat$f.41280.0.72)
dat$f.41280.0.73 <- as.Date(dat$f.41280.0.73)
dat$f.41280.0.74 <- as.Date(dat$f.41280.0.74)
dat$f.41280.0.75 <- as.Date(dat$f.41280.0.75)
dat$f.41280.0.76 <- as.Date(dat$f.41280.0.76)
dat$f.41280.0.77 <- as.Date(dat$f.41280.0.77)
dat$f.41280.0.78 <- as.Date(dat$f.41280.0.78)
dat$f.41280.0.79 <- as.Date(dat$f.41280.0.79)
dat$f.41280.0.80 <- as.Date(dat$f.41280.0.80)
dat$f.41280.0.81 <- as.Date(dat$f.41280.0.81)
dat$f.41280.0.82 <- as.Date(dat$f.41280.0.82)
dat$f.41280.0.83 <- as.Date(dat$f.41280.0.83)
dat$f.41280.0.84 <- as.Date(dat$f.41280.0.84)
dat$f.41280.0.85 <- as.Date(dat$f.41280.0.85)
dat$f.41280.0.86 <- as.Date(dat$f.41280.0.86)
dat$f.41280.0.87 <- as.Date(dat$f.41280.0.87)
dat$f.41280.0.88 <- as.Date(dat$f.41280.0.88)
dat$f.41280.0.89 <- as.Date(dat$f.41280.0.89)
dat$f.41280.0.90 <- as.Date(dat$f.41280.0.90)
dat$f.41280.0.91 <- as.Date(dat$f.41280.0.91)
dat$f.41280.0.92 <- as.Date(dat$f.41280.0.92)
dat$f.41280.0.93 <- as.Date(dat$f.41280.0.93)
dat$f.41280.0.94 <- as.Date(dat$f.41280.0.94)
dat$f.41280.0.95 <- as.Date(dat$f.41280.0.95)
dat$f.41280.0.96 <- as.Date(dat$f.41280.0.96)
dat$f.41280.0.97 <- as.Date(dat$f.41280.0.97)
dat$f.41280.0.98 <- as.Date(dat$f.41280.0.98)
dat$f.41280.0.99 <- as.Date(dat$f.41280.0.99)
dat$f.41280.0.100 <- as.Date(dat$f.41280.0.100)
dat$f.41280.0.101 <- as.Date(dat$f.41280.0.101)
dat$f.41280.0.102 <- as.Date(dat$f.41280.0.102)
dat$f.41280.0.103 <- as.Date(dat$f.41280.0.103)
dat$f.41280.0.104 <- as.Date(dat$f.41280.0.104)
dat$f.41280.0.105 <- as.Date(dat$f.41280.0.105)
dat$f.41280.0.106 <- as.Date(dat$f.41280.0.106)
dat$f.41280.0.107 <- as.Date(dat$f.41280.0.107)
dat$f.41280.0.108 <- as.Date(dat$f.41280.0.108)
dat$f.41280.0.109 <- as.Date(dat$f.41280.0.109)
dat$f.41280.0.110 <- as.Date(dat$f.41280.0.110)
dat$f.41280.0.111 <- as.Date(dat$f.41280.0.111)
dat$f.41280.0.112 <- as.Date(dat$f.41280.0.112)
dat$f.41280.0.113 <- as.Date(dat$f.41280.0.113)
dat$f.41280.0.114 <- as.Date(dat$f.41280.0.114)
dat$f.41280.0.115 <- as.Date(dat$f.41280.0.115)
dat$f.41280.0.116 <- as.Date(dat$f.41280.0.116)
dat$f.41280.0.117 <- as.Date(dat$f.41280.0.117)
dat$f.41280.0.118 <- as.Date(dat$f.41280.0.118)
dat$f.41280.0.119 <- as.Date(dat$f.41280.0.119)
dat$f.41280.0.120 <- as.Date(dat$f.41280.0.120)
dat$f.41280.0.121 <- as.Date(dat$f.41280.0.121)
dat$f.41280.0.122 <- as.Date(dat$f.41280.0.122)
dat$f.41280.0.123 <- as.Date(dat$f.41280.0.123)
dat$f.41280.0.124 <- as.Date(dat$f.41280.0.124)
dat$f.41280.0.125 <- as.Date(dat$f.41280.0.125)
dat$f.41280.0.126 <- as.Date(dat$f.41280.0.126)
dat$f.41280.0.127 <- as.Date(dat$f.41280.0.127)
dat$f.41280.0.128 <- as.Date(dat$f.41280.0.128)
dat$f.41280.0.129 <- as.Date(dat$f.41280.0.129)
dat$f.41280.0.130 <- as.Date(dat$f.41280.0.130)
dat$f.41280.0.131 <- as.Date(dat$f.41280.0.131)
dat$f.41280.0.132 <- as.Date(dat$f.41280.0.132)
dat$f.41280.0.133 <- as.Date(dat$f.41280.0.133)
dat$f.41280.0.134 <- as.Date(dat$f.41280.0.134)
dat$f.41280.0.135 <- as.Date(dat$f.41280.0.135)
dat$f.41280.0.136 <- as.Date(dat$f.41280.0.136)
dat$f.41280.0.137 <- as.Date(dat$f.41280.0.137)
dat$f.41280.0.138 <- as.Date(dat$f.41280.0.138)
dat$f.41280.0.139 <- as.Date(dat$f.41280.0.139)
dat$f.41280.0.140 <- as.Date(dat$f.41280.0.140)
dat$f.41280.0.141 <- as.Date(dat$f.41280.0.141)
dat$f.41280.0.142 <- as.Date(dat$f.41280.0.142)
dat$f.41280.0.143 <- as.Date(dat$f.41280.0.143)
dat$f.41280.0.144 <- as.Date(dat$f.41280.0.144)
dat$f.41280.0.145 <- as.Date(dat$f.41280.0.145)
dat$f.41280.0.146 <- as.Date(dat$f.41280.0.146)
dat$f.41280.0.147 <- as.Date(dat$f.41280.0.147)
dat$f.41280.0.148 <- as.Date(dat$f.41280.0.148)
dat$f.41280.0.149 <- as.Date(dat$f.41280.0.149)
dat$f.41280.0.150 <- as.Date(dat$f.41280.0.150)
dat$f.41280.0.151 <- as.Date(dat$f.41280.0.151)
dat$f.41280.0.152 <- as.Date(dat$f.41280.0.152)
dat$f.41280.0.153 <- as.Date(dat$f.41280.0.153)
dat$f.41280.0.154 <- as.Date(dat$f.41280.0.154)
dat$f.41280.0.155 <- as.Date(dat$f.41280.0.155)
dat$f.41280.0.156 <- as.Date(dat$f.41280.0.156)
dat$f.41280.0.157 <- as.Date(dat$f.41280.0.157)
dat$f.41280.0.158 <- as.Date(dat$f.41280.0.158)
dat$f.41280.0.159 <- as.Date(dat$f.41280.0.159)
dat$f.41280.0.160 <- as.Date(dat$f.41280.0.160)
dat$f.41280.0.161 <- as.Date(dat$f.41280.0.161)
dat$f.41280.0.162 <- as.Date(dat$f.41280.0.162)
dat$f.41280.0.163 <- as.Date(dat$f.41280.0.163)
dat$f.41280.0.164 <- as.Date(dat$f.41280.0.164)
dat$f.41280.0.165 <- as.Date(dat$f.41280.0.165)
dat$f.41280.0.166 <- as.Date(dat$f.41280.0.166)
dat$f.41280.0.167 <- as.Date(dat$f.41280.0.167)
dat$f.41280.0.168 <- as.Date(dat$f.41280.0.168)
dat$f.41280.0.169 <- as.Date(dat$f.41280.0.169)
dat$f.41280.0.170 <- as.Date(dat$f.41280.0.170)
dat$f.41280.0.171 <- as.Date(dat$f.41280.0.171)
dat$f.41280.0.172 <- as.Date(dat$f.41280.0.172)
dat$f.41280.0.173 <- as.Date(dat$f.41280.0.173)
dat$f.41280.0.174 <- as.Date(dat$f.41280.0.174)
dat$f.41280.0.175 <- as.Date(dat$f.41280.0.175)
dat$f.41280.0.176 <- as.Date(dat$f.41280.0.176)
dat$f.41280.0.177 <- as.Date(dat$f.41280.0.177)
dat$f.41280.0.178 <- as.Date(dat$f.41280.0.178)
dat$f.41280.0.179 <- as.Date(dat$f.41280.0.179)
dat$f.41280.0.180 <- as.Date(dat$f.41280.0.180)
dat$f.41280.0.181 <- as.Date(dat$f.41280.0.181)
dat$f.41280.0.182 <- as.Date(dat$f.41280.0.182)
dat$f.41280.0.183 <- as.Date(dat$f.41280.0.183)
dat$f.41280.0.184 <- as.Date(dat$f.41280.0.184)
dat$f.41280.0.185 <- as.Date(dat$f.41280.0.185)
dat$f.41280.0.186 <- as.Date(dat$f.41280.0.186)
dat$f.41280.0.187 <- as.Date(dat$f.41280.0.187)
dat$f.41280.0.188 <- as.Date(dat$f.41280.0.188)
dat$f.41280.0.189 <- as.Date(dat$f.41280.0.189)
dat$f.41280.0.190 <- as.Date(dat$f.41280.0.190)
dat$f.41280.0.191 <- as.Date(dat$f.41280.0.191)
dat$f.41280.0.192 <- as.Date(dat$f.41280.0.192)
dat$f.41280.0.193 <- as.Date(dat$f.41280.0.193)
dat$f.41280.0.194 <- as.Date(dat$f.41280.0.194)
dat$f.41280.0.195 <- as.Date(dat$f.41280.0.195)
dat$f.41280.0.196 <- as.Date(dat$f.41280.0.196)
dat$f.41280.0.197 <- as.Date(dat$f.41280.0.197)
dat$f.41280.0.198 <- as.Date(dat$f.41280.0.198)
dat$f.41280.0.199 <- as.Date(dat$f.41280.0.199)
dat$f.41280.0.200 <- as.Date(dat$f.41280.0.200)
dat$f.41280.0.201 <- as.Date(dat$f.41280.0.201)
dat$f.41280.0.202 <- as.Date(dat$f.41280.0.202)
dat$f.41280.0.203 <- as.Date(dat$f.41280.0.203)
dat$f.41280.0.204 <- as.Date(dat$f.41280.0.204)
dat$f.41280.0.205 <- as.Date(dat$f.41280.0.205)
dat$f.41280.0.206 <- as.Date(dat$f.41280.0.206)
dat$f.41280.0.207 <- as.Date(dat$f.41280.0.207)
dat$f.41280.0.208 <- as.Date(dat$f.41280.0.208)
dat$f.41280.0.209 <- as.Date(dat$f.41280.0.209)
dat$f.41280.0.210 <- as.Date(dat$f.41280.0.210)
dat$f.41280.0.211 <- as.Date(dat$f.41280.0.211)
dat$f.41280.0.212 <- as.Date(dat$f.41280.0.212)
dat$f.41280.0.213 <- as.Date(dat$f.41280.0.213)
dat$f.41280.0.214 <- as.Date(dat$f.41280.0.214)
dat$f.41280.0.215 <- as.Date(dat$f.41280.0.215)
dat$f.41280.0.216 <- as.Date(dat$f.41280.0.216)
dat$f.41280.0.217 <- as.Date(dat$f.41280.0.217)
dat$f.41280.0.218 <- as.Date(dat$f.41280.0.218)
dat$f.41280.0.219 <- as.Date(dat$f.41280.0.219)
dat$f.41280.0.220 <- as.Date(dat$f.41280.0.220)
dat$f.41280.0.221 <- as.Date(dat$f.41280.0.221)
dat$f.41280.0.222 <- as.Date(dat$f.41280.0.222)
dat$f.41280.0.223 <- as.Date(dat$f.41280.0.223)
dat$f.41280.0.224 <- as.Date(dat$f.41280.0.224)
dat$f.41280.0.225 <- as.Date(dat$f.41280.0.225)

#Load function
source("UKBexpFunc.R")

#All ICD10 data
allICD10 <- unlist(dat %>% select(starts_with("f.41270.")), use.names=F) #this searches your columns for all unique values and lists them
allICD10<-allICD10[!is.na(allICD10)] # removes NA
allICD10<-allICD10[!duplicated(allICD10)] # removes duplicate ICD10 codes

#Subset for only ICD10 codes of interest 
toMatch <- c("I210", "I211", "I212", "I213", "I214", "I219") #ICD10 codes for acute MI
#OR
toMatch <- c("I801", "I802") #ICD10 codes for DVT
#OR
toMatch <- c("I260", "I269") #ICD10 codes for PE
thrombotic_events_ICD10 <- unique(grep(paste(toMatch,collapse="|"), allICD10, value=TRUE))
table(thrombotic_events_ICD10) #Check the codes of interest that were matched

#Run function 
res_ICD10cases <- UKBexpFunc(dat= dat, exposureCode = thrombotic_events_ICD10, sitename = "thrombotic.events.ICD10", other=F, exp_col = "f.41270.")
res_ICD10controls <- UKBexpFunc(dat= dat, exposureCode = thrombotic_events_ICD10, sitename = "otherICD10", other=TRUE)
res <- full_join(res_ICD10cases, res_ICD10controls)

# How many diagnosis of ICD10 vars?
ICD10_cases <- res %>% dplyr:: select(starts_with("thrombotic"))
str(df, list.len=ncol(ICD10_cases)) 
ICD10_other <- res %>% dplyr:: select(starts_with("other"))
str(df, list.len=ncol(ICD10_other)) 

ICD10_res <- res %>% select("projectID", "ieu", "PLT_initial_SD", "PLT_dates_initial","MPV_initial_SD", "MPVdates_initial", starts_with("thrombotic.events.ICD10"), start_with("other")) #To match PLT with ICD10 cases
#OR
ICD10_res <- res %>% select("projectID", "ieu", "MPV_initial_SD", "MPVdates_initial", starts_with("thrombotic.events.ICD10"), start_with("other")) # To make MPV to ICD10 

#Format results 
# 1. split the ICD10 diagnoses: #ICD_code/date_of_diagnosis
# 2. format columns
# 3. generate incidence of ICD10 flag
# 4. define controls
# 5. define incident cases
# 6. tidy up data

library(tidyr); library(dplyr)

df <- ICD10_res 
rm(ICD10_res)
df <- as.data.frame(df) 

#Perform step 1 
df2 <-separate(df, thrombotic.events.ICD101, into = c("thrombotic.events.ICD10.1", "thromobtic.events.ICD10.date.diagnosis.1"), sep = "/")
df3 <-separate(df2, thrombotic.events.ICD102, into = c("thrombotic.events.ICD10.2", "thromobtic.events.ICD10.date.diagnosis.2"), sep = "/")
df4 <-separate(df3, thrombotic.events.ICD103, into = c("thrombotic.events.ICD10.3", "thromobtic.events.ICD10.date.diagnosis.3"), sep = "/")
df5 <-separate(df4, thrombotic.events.ICD104, into = c("thrombotic.events.ICD10.4", "thromobtic.events.ICD10.date.diagnosis.4"), sep = "/")
df6 <-separate(df5, thrombotic.events.ICD105, into = c("thrombotic.events.ICD10.5", "thromobtic.events.ICD10.date.diagnosis.5"), sep = "/")
df7 <-separate(df6, thrombotic.events.ICD106, into = c("thrombotic.events.ICD10.6", "thromobtic.events.ICD10.date.diagnosis.6"), sep = "/")
df8 <-separate(df7, thrombotic.events.ICD107, into = c("thrombotic.events.ICD10.7", "thromobtic.events.ICD10.date.diagnosis.7"), sep = "/")
df9 <-separate(df8, thrombotic.events.ICD108, into = c("thrombotic.events.ICD10.8", "thromobtic.events.ICD10.date.diagnosis.8"), sep = "/")
df10 <-separate(df9, thrombotic.events.ICD109, into = c("thrombotic.events.ICD10.9", "thromobtic.events.ICD10.date.diagnosis.9"), sep = "/")
df11 <-separate(df10, thrombotic.events.ICD1010, into = c("thrombotic.events.ICD10.10", "thromobtic.events.ICD10.date.diagnosis.10"), sep = "/")
df12<-separate(df11, thrombotic.events.ICD1011,into=c("thrombotic.events.ICD10.11","thromobtic.events.ICD10.date.diagnosis.11"),sep="/")
df13<-separate(df12, thrombotic.events.ICD1012,into=c("thrombotic.events.ICD10.12","thromobtic.events.ICD10.date.diagnosis.12"),sep="/")
df14<-separate(df13, thrombotic.events.ICD1013,into=c("thrombotic.events.ICD10.13","thromobtic.events.ICD10.date.diagnosis.13"),sep="/")
df15<-separate(df14, thrombotic.events.ICD1014,into=c("thrombotic.events.ICD10.14","thromobtic.events.ICD10.date.diagnosis.14"),sep="/")
df16<-separate(df15, thrombotic.events.ICD1015,into=c("thrombotic.events.ICD10.15","thromobtic.events.ICD10.date.diagnosis.15"),sep="/")
df17<-separate(df16, thrombotic.events.ICD1016,into=c("thrombotic.events.ICD10.16","thromobtic.events.ICD10.date.diagnosis.16"),sep="/")
df18<-separate(df17, thrombotic.events.ICD1017,into=c("thrombotic.events.ICD10.17","thromobtic.events.ICD10.date.diagnosis.17"),sep="/")
df19<-separate(df18, thrombotic.events.ICD1018,into=c("thrombotic.events.ICD10.18","thromobtic.events.ICD10.date.diagnosis.18"),sep="/")
df20<-separate(df19, thrombotic.events.ICD1019,into=c("thrombotic.events.ICD10.19","thromobtic.events.ICD10.date.diagnosis.19"),sep="/")
df21<-separate(df20, thrombotic.events.ICD1020,into=c("thrombotic.events.ICD10.20","thromobtic.events.ICD10.date.diagnosis.20"),sep="/")
df22<-separate(df21, thrombotic.events.ICD1021,into=c("thrombotic.events.ICD10.21","thromobtic.events.ICD10.date.diagnosis.21"),sep="/")
df23<-separate(df22, thrombotic.events.ICD1022,into=c("thrombotic.events.ICD10.22","thromobtic.events.ICD10.date.diagnosis.22"),sep="/")
df24<-separate(df23, thrombotic.events.ICD1023,into=c("thrombotic.events.ICD10.23","thromobtic.events.ICD10.date.diagnosis.23"),sep="/")
df25<-separate(df24, thrombotic.events.ICD1024,into=c("thrombotic.events.ICD10.24","thromobtic.events.ICD10.date.diagnosis.24"),sep="/")
df26<-separate(df25, thrombotic.events.ICD1025,into=c("thrombotic.events.ICD10.25","thromobtic.events.ICD10.date.diagnosis.25"),sep="/")
df27<-separate(df26, thrombotic.events.ICD1026,into=c("thrombotic.events.ICD10.26","thromobtic.events.ICD10.date.diagnosis.26"),sep="/")
df28<-separate(df27, thrombotic.events.ICD1027,into=c("thrombotic.events.ICD10.27","thromobtic.events.ICD10.date.diagnosis.27"),sep="/")
df29<-separate(df28, thrombotic.events.ICD1028,into=c("thrombotic.events.ICD10.28","thromobtic.events.ICD10.date.diagnosis.28"),sep="/")
df30<-separate(df29, thrombotic.events.ICD1029,into=c("thrombotic.events.ICD10.29","thromobtic.events.ICD10.date.diagnosis.29"),sep="/")
df31<-separate(df30, thrombotic.events.ICD1030,into=c("thrombotic.events.ICD10.30","thromobtic.events.ICD10.date.diagnosis.30"),sep="/")
df32<-separate(df31, thrombotic.events.ICD1031,into=c("thrombotic.events.ICD10.31","thromobtic.events.ICD10.date.diagnosis.31"),sep="/")
df33<-separate(df32, thrombotic.events.ICD1032,into=c("thrombotic.events.ICD10.32","thromobtic.events.ICD10.date.diagnosis.32"),sep="/")
df34<-separate(df33, thrombotic.events.ICD1033,into=c("thrombotic.events.ICD10.33","thromobtic.events.ICD10.date.diagnosis.33"),sep="/")
df35<-separate(df34, thrombotic.events.ICD1034,into=c("thrombotic.events.ICD10.34","thromobtic.events.ICD10.date.diagnosis.34"),sep="/")
df36<-separate(df35, thrombotic.events.ICD1035,into=c("thrombotic.events.ICD10.35","thromobtic.events.ICD10.date.diagnosis.35"),sep="/")
df37<-separate(df36, thrombotic.events.ICD1036,into=c("thrombotic.events.ICD10.36","thromobtic.events.ICD10.date.diagnosis.36"),sep="/")
df38<-separate(df37, thrombotic.events.ICD1037,into=c("thrombotic.events.ICD10.37","thromobtic.events.ICD10.date.diagnosis.37"),sep="/")
df39<-separate(df38, thrombotic.events.ICD1038,into=c("thrombotic.events.ICD10.38","thromobtic.events.ICD10.date.diagnosis.38"),sep="/")
df40<-separate(df39, thrombotic.events.ICD1039,into=c("thrombotic.events.ICD10.39","thromobtic.events.ICD10.date.diagnosis.39"),sep="/")
df41<-separate(df40, thrombotic.events.ICD1040,into=c("thrombotic.events.ICD10.40","thromobtic.events.ICD10.date.diagnosis.40"),sep="/")
df42<-separate(df41, thrombotic.events.ICD1041,into=c("thrombotic.events.ICD10.41","thromobtic.events.ICD10.date.diagnosis.41"),sep="/")
df43<-separate(df42, thrombotic.events.ICD1042,into=c("thrombotic.events.ICD10.42","thromobtic.events.ICD10.date.diagnosis.42"),sep="/")
df44<-separate(df43, thrombotic.events.ICD1043,into=c("thrombotic.events.ICD10.43","thromobtic.events.ICD10.date.diagnosis.43"),sep="/")
df45<-separate(df44, thrombotic.events.ICD1044,into=c("thrombotic.events.ICD10.44","thromobtic.events.ICD10.date.diagnosis.44"),sep="/")
df46<-separate(df45, thrombotic.events.ICD1045,into=c("thrombotic.events.ICD10.45","thromobtic.events.ICD10.date.diagnosis.45"),sep="/")
df47<-separate(df46, thrombotic.events.ICD1046,into=c("thrombotic.events.ICD10.46","thromobtic.events.ICD10.date.diagnosis.46"),sep="/")
df48<-separate(df47, thrombotic.events.ICD1047,into=c("thrombotic.events.ICD10.47","thromobtic.events.ICD10.date.diagnosis.47"),sep="/")
df49<-separate(df48, thrombotic.events.ICD1048,into=c("thrombotic.events.ICD10.48","thromobtic.events.ICD10.date.diagnosis.48"),sep="/")
df50<-separate(df49, thrombotic.events.ICD1049,into=c("thrombotic.events.ICD10.49","thromobtic.events.ICD10.date.diagnosis.49"),sep="/")
df51<-separate(df50, thrombotic.events.ICD1050,into=c("thrombotic.events.ICD10.50","thromobtic.events.ICD10.date.diagnosis.50"),sep="/")
df52<-separate(df51, thrombotic.events.ICD1051,into=c("thrombotic.events.ICD10.51","thromobtic.events.ICD10.date.diagnosis.51"),sep="/")
df53<-separate(df52, thrombotic.events.ICD1052,into=c("thrombotic.events.ICD10.52","thromobtic.events.ICD10.date.diagnosis.52"),sep="/")
df54<-separate(df53, thrombotic.events.ICD1053,into=c("thrombotic.events.ICD10.53","thromobtic.events.ICD10.date.diagnosis.53"),sep="/")
df55<-separate(df54, thrombotic.events.ICD1054,into=c("thrombotic.events.ICD10.54","thromobtic.events.ICD10.date.diagnosis.54"),sep="/")
df56<-separate(df55, thrombotic.events.ICD1055,into=c("thrombotic.events.ICD10.55","thromobtic.events.ICD10.date.diagnosis.55"),sep="/")
df57<-separate(df56, thrombotic.events.ICD1056,into=c("thrombotic.events.ICD10.56","thromobtic.events.ICD10.date.diagnosis.56"),sep="/")
df58<-separate(df57, thrombotic.events.ICD1057,into=c("thrombotic.events.ICD10.57","thromobtic.events.ICD10.date.diagnosis.57"),sep="/")
df59<-separate(df58, thrombotic.events.ICD1058,into=c("thrombotic.events.ICD10.58","thromobtic.events.ICD10.date.diagnosis.58"),sep="/")
df60<-separate(df59, thrombotic.events.ICD1059,into=c("thrombotic.events.ICD10.59","thromobtic.events.ICD10.date.diagnosis.59"),sep="/")
df61<-separate(df60, thrombotic.events.ICD1060,into=c("thrombotic.events.ICD10.60","thromobtic.events.ICD10.date.diagnosis.60"),sep="/")
df62<-separate(df61, thrombotic.events.ICD1061,into=c("thrombotic.events.ICD10.61","thromobtic.events.ICD10.date.diagnosis.61"),sep="/")
df63<-separate(df62, thrombotic.events.ICD1062,into=c("thrombotic.events.ICD10.62","thromobtic.events.ICD10.date.diagnosis.62"),sep="/")
df64<-separate(df63, thrombotic.events.ICD1063,into=c("thrombotic.events.ICD10.63","thromobtic.events.ICD10.date.diagnosis.63"),sep="/")
df65<-separate(df64, thrombotic.events.ICD1064,into=c("thrombotic.events.ICD10.64","thromobtic.events.ICD10.date.diagnosis.64"),sep="/")
df66<-separate(df65, thrombotic.events.ICD1065,into=c("thrombotic.events.ICD10.65","thromobtic.events.ICD10.date.diagnosis.65"),sep="/")
df67<-separate(df66, thrombotic.events.ICD1066,into=c("thrombotic.events.ICD10.66","thromobtic.events.ICD10.date.diagnosis.66"),sep="/")
df68<-separate(df67, thrombotic.events.ICD1067,into=c("thrombotic.events.ICD10.67","thromobtic.events.ICD10.date.diagnosis.67"),sep="/")
df69<-separate(df68, thrombotic.events.ICD1068,into=c("thrombotic.events.ICD10.68","thromobtic.events.ICD10.date.diagnosis.68"),sep="/")
df70<-separate(df69, thrombotic.events.ICD1069,into=c("thrombotic.events.ICD10.69","thromobtic.events.ICD10.date.diagnosis.69"),sep="/")
df71<-separate(df70, thrombotic.events.ICD1070,into=c("thrombotic.events.ICD10.70","thromobtic.events.ICD10.date.diagnosis.70"),sep="/")
df72<-separate(df71, thrombotic.events.ICD1071,into=c("thrombotic.events.ICD10.71","thromobtic.events.ICD10.date.diagnosis.71"),sep="/")
df73<-separate(df72, thrombotic.events.ICD1072,into=c("thrombotic.events.ICD10.72","thromobtic.events.ICD10.date.diagnosis.72"),sep="/")
df74<-separate(df73, thrombotic.events.ICD1073,into=c("thrombotic.events.ICD10.73","thromobtic.events.ICD10.date.diagnosis.73"),sep="/")
df75<-separate(df74, thrombotic.events.ICD1074,into=c("thrombotic.events.ICD10.74","thromobtic.events.ICD10.date.diagnosis.74"),sep="/")
df76<-separate(df75, thrombotic.events.ICD1075,into=c("thrombotic.events.ICD10.75","thromobtic.events.ICD10.date.diagnosis.75"),sep="/")
df77<-separate(df76, thrombotic.events.ICD1076,into=c("thrombotic.events.ICD10.76","thromobtic.events.ICD10.date.diagnosis.76"),sep="/")
df78<-separate(df77, thrombotic.events.ICD1077,into=c("thrombotic.events.ICD10.77","thromobtic.events.ICD10.date.diagnosis.77"),sep="/")
df79<-separate(df78, thrombotic.events.ICD1078,into=c("thrombotic.events.ICD10.78","thromobtic.events.ICD10.date.diagnosis.78"),sep="/")
df80<-separate(df79, thrombotic.events.ICD1079,into=c("thrombotic.events.ICD10.79","thromobtic.events.ICD10.date.diagnosis.79"),sep="/")
df81<-separate(df80, thrombotic.events.ICD1080,into=c("thrombotic.events.ICD10.80","thromobtic.events.ICD10.date.diagnosis.80"),sep="/")
df82<-separate(df81, thrombotic.events.ICD1081,into=c("thrombotic.events.ICD10.81","thromobtic.events.ICD10.date.diagnosis.81"),sep="/")
df83<-separate(df82, thrombotic.events.ICD1082,into=c("thrombotic.events.ICD10.82","thromobtic.events.ICD10.date.diagnosis.82"),sep="/")
df84<-separate(df83, thrombotic.events.ICD1083,into=c("thrombotic.events.ICD10.83","thromobtic.events.ICD10.date.diagnosis.83"),sep="/")
df85<-separate(df84, thrombotic.events.ICD1084,into=c("thrombotic.events.ICD10.84","thromobtic.events.ICD10.date.diagnosis.84"),sep="/")
df86<-separate(df85, thrombotic.events.ICD1085,into=c("thrombotic.events.ICD10.85","thromobtic.events.ICD10.date.diagnosis.85"),sep="/")
df87<-separate(df86, thrombotic.events.ICD1086,into=c("thrombotic.events.ICD10.86","thromobtic.events.ICD10.date.diagnosis.86"),sep="/")
df88<-separate(df87, thrombotic.events.ICD1087,into=c("thrombotic.events.ICD10.87","thromobtic.events.ICD10.date.diagnosis.87"),sep="/")
df89<-separate(df88, thrombotic.events.ICD1088,into=c("thrombotic.events.ICD10.88","thromobtic.events.ICD10.date.diagnosis.88"),sep="/")
df90<-separate(df89, thrombotic.events.ICD1089,into=c("thrombotic.events.ICD10.89","thromobtic.events.ICD10.date.diagnosis.89"),sep="/")
df91<-separate(df90, thrombotic.events.ICD1090,into=c("thrombotic.events.ICD10.90","thromobtic.events.ICD10.date.diagnosis.90"),sep="/")
df92<-separate(df91, thrombotic.events.ICD1091,into=c("thrombotic.events.ICD10.91","thromobtic.events.ICD10.date.diagnosis.91"),sep="/")
df93<-separate(df92, thrombotic.events.ICD1092,into=c("thrombotic.events.ICD10.92","thromobtic.events.ICD10.date.diagnosis.92"),sep="/")
df94<-separate(df93, thrombotic.events.ICD1093,into=c("thrombotic.events.ICD10.93","thromobtic.events.ICD10.date.diagnosis.93"),sep="/")
df95<-separate(df94, thrombotic.events.ICD1094,into=c("thrombotic.events.ICD10.94","thromobtic.events.ICD10.date.diagnosis.94"),sep="/")
df96<-separate(df95, thrombotic.events.ICD1095,into=c("thrombotic.events.ICD10.95","thromobtic.events.ICD10.date.diagnosis.95"),sep="/")
df97<-separate(df96, thrombotic.events.ICD1096,into=c("thrombotic.events.ICD10.96","thromobtic.events.ICD10.date.diagnosis.96"),sep="/")
df98<-separate(df97, thrombotic.events.ICD1097,into=c("thrombotic.events.ICD10.97","thromobtic.events.ICD10.date.diagnosis.97"),sep="/")
df99<-separate(df98, thrombotic.events.ICD1098,into=c("thrombotic.events.ICD10.98","thromobtic.events.ICD10.date.diagnosis.98"),sep="/")
df100<-separate(df99, thrombotic.events.ICD1099,into=c("thrombotic.events.ICD10.99","thromobtic.events.ICD10.date.diagnosis.99"),sep="/")
df101<-separate(df100, thrombotic.events.ICD1100,into=c("thrombotic.events.ICD10.100","thromobtic.events.ICD10.date.diagnosis.100"),sep="/")
df102<-separate(df101, thrombotic.events.ICD1101,into=c("thrombotic.events.ICD10.101","thromobtic.events.ICD10.date.diagnosis.101"),sep="/")
df103<-separate(df102, thrombotic.events.ICD1102,into=c("thrombotic.events.ICD10.102","thromobtic.events.ICD10.date.diagnosis.102"),sep="/")
df104<-separate(df103, thrombotic.events.ICD1103,into=c("thrombotic.events.ICD10.103","thromobtic.events.ICD10.date.diagnosis.103"),sep="/")
df105<-separate(df104, thrombotic.events.ICD1104,into=c("thrombotic.events.ICD10.104","thromobtic.events.ICD10.date.diagnosis.104"),sep="/")
df106<-separate(df105, thrombotic.events.ICD1105,into=c("thrombotic.events.ICD10.105","thromobtic.events.ICD10.date.diagnosis.105"),sep="/")
df107<-separate(df106, thrombotic.events.ICD1106,into=c("thrombotic.events.ICD10.106","thromobtic.events.ICD10.date.diagnosis.106"),sep="/")
df108<-separate(df107, thrombotic.events.ICD1107,into=c("thrombotic.events.ICD10.107","thromobtic.events.ICD10.date.diagnosis.107"),sep="/")
df109<-separate(df108, thrombotic.events.ICD1108,into=c("thrombotic.events.ICD10.108","thromobtic.events.ICD10.date.diagnosis.108"),sep="/")
df110<-separate(df109, thrombotic.events.ICD1109,into=c("thrombotic.events.ICD10.109","thromobtic.events.ICD10.date.diagnosis.109"),sep="/")
df111<-separate(df110, thrombotic.events.ICD1110,into=c("thrombotic.events.ICD10.110","thromobtic.events.ICD10.date.diagnosis.110"),sep="/")
df112<-separate(df111, thrombotic.events.ICD1111,into=c("thrombotic.events.ICD10.111","thromobtic.events.ICD10.date.diagnosis.111"),sep="/")
df113<-separate(df112, thrombotic.events.ICD1112,into=c("thrombotic.events.ICD10.112","thromobtic.events.ICD10.date.diagnosis.112"),sep="/")
df114<-separate(df113, thrombotic.events.ICD1113,into=c("thrombotic.events.ICD10.113","thromobtic.events.ICD10.date.diagnosis.113"),sep="/")
df115<-separate(df114, thrombotic.events.ICD1114,into=c("thrombotic.events.ICD10.114","thromobtic.events.ICD10.date.diagnosis.114"),sep="/")
df116<-separate(df115, thrombotic.events.ICD1115,into=c("thrombotic.events.ICD10.115","thromobtic.events.ICD10.date.diagnosis.115"),sep="/")
df117<-separate(df116, thrombotic.events.ICD1116,into=c("thrombotic.events.ICD10.116","thromobtic.events.ICD10.date.diagnosis.116"),sep="/")
df118<-separate(df117, thrombotic.events.ICD1117,into=c("thrombotic.events.ICD10.117","thromobtic.events.ICD10.date.diagnosis.117"),sep="/")
df119<-separate(df118, thrombotic.events.ICD1118,into=c("thrombotic.events.ICD10.118","thromobtic.events.ICD10.date.diagnosis.118"),sep="/")
df120<-separate(df119, thrombotic.events.ICD1119,into=c("thrombotic.events.ICD10.119","thromobtic.events.ICD10.date.diagnosis.119"),sep="/")
df121<-separate(df120, thrombotic.events.ICD1120,into=c("thrombotic.events.ICD10.120","thromobtic.events.ICD10.date.diagnosis.120"),sep="/")
df122<-separate(df121, thrombotic.events.ICD1121,into=c("thrombotic.events.ICD10.121","thromobtic.events.ICD10.date.diagnosis.121"),sep="/")
df123<-separate(df122, thrombotic.events.ICD1122,into=c("thrombotic.events.ICD10.122","thromobtic.events.ICD10.date.diagnosis.122"),sep="/")
df124<-separate(df123, thrombotic.events.ICD1123,into=c("thrombotic.events.ICD10.123","thromobtic.events.ICD10.date.diagnosis.123"),sep="/")
df125<-separate(df124, thrombotic.events.ICD1124,into=c("thrombotic.events.ICD10.124","thromobtic.events.ICD10.date.diagnosis.124"),sep="/")
df126<-separate(df125, thrombotic.events.ICD1125,into=c("thrombotic.events.ICD10.125","thromobtic.events.ICD10.date.diagnosis.125"),sep="/")
df127<-separate(df126, thrombotic.events.ICD1126,into=c("thrombotic.events.ICD10.126","thromobtic.events.ICD10.date.diagnosis.126"),sep="/")
df128<-separate(df127, thrombotic.events.ICD1127,into=c("thrombotic.events.ICD10.127","thromobtic.events.ICD10.date.diagnosis.127"),sep="/")
df129<-separate(df128, thrombotic.events.ICD1128,into=c("thrombotic.events.ICD10.128","thromobtic.events.ICD10.date.diagnosis.128"),sep="/")
df130<-separate(df129, thrombotic.events.ICD1129,into=c("thrombotic.events.ICD10.129","thromobtic.events.ICD10.date.diagnosis.129"),sep="/")
df131<-separate(df130, thrombotic.events.ICD1130,into=c("thrombotic.events.ICD10.130","thromobtic.events.ICD10.date.diagnosis.130"),sep="/")
df132<-separate(df131, thrombotic.events.ICD1131,into=c("thrombotic.events.ICD10.131","thromobtic.events.ICD10.date.diagnosis.131"),sep="/")
df133<-separate(df132, thrombotic.events.ICD1132,into=c("thrombotic.events.ICD10.132","thromobtic.events.ICD10.date.diagnosis.132"),sep="/")
df134<-separate(df133, thrombotic.events.ICD1133,into=c("thrombotic.events.ICD10.133","thromobtic.events.ICD10.date.diagnosis.133"),sep="/")
df135<-separate(df134, thrombotic.events.ICD1134,into=c("thrombotic.events.ICD10.134","thromobtic.events.ICD10.date.diagnosis.134"),sep="/")
df136<-separate(df135, thrombotic.events.ICD1135,into=c("thrombotic.events.ICD10.135","thromobtic.events.ICD10.date.diagnosis.135"),sep="/")
df137<-separate(df136, thrombotic.events.ICD1136,into=c("thrombotic.events.ICD10.136","thromobtic.events.ICD10.date.diagnosis.136"),sep="/")
df138<-separate(df137, thrombotic.events.ICD1137,into=c("thrombotic.events.ICD10.137","thromobtic.events.ICD10.date.diagnosis.137"),sep="/")
df139<-separate(df138, thrombotic.events.ICD1138,into=c("thrombotic.events.ICD10.138","thromobtic.events.ICD10.date.diagnosis.138"),sep="/")
df140<-separate(df139, thrombotic.events.ICD1139,into=c("thrombotic.events.ICD10.139","thromobtic.events.ICD10.date.diagnosis.139"),sep="/")
df141<-separate(df140, thrombotic.events.ICD1140,into=c("thrombotic.events.ICD10.140","thromobtic.events.ICD10.date.diagnosis.140"),sep="/")
df142<-separate(df141, thrombotic.events.ICD1141,into=c("thrombotic.events.ICD10.141","thromobtic.events.ICD10.date.diagnosis.141"),sep="/")
df143<-separate(df142, thrombotic.events.ICD1142,into=c("thrombotic.events.ICD10.142","thromobtic.events.ICD10.date.diagnosis.142"),sep="/")
df144<-separate(df143, thrombotic.events.ICD1143,into=c("thrombotic.events.ICD10.143","thromobtic.events.ICD10.date.diagnosis.143"),sep="/")
df145<-separate(df144, thrombotic.events.ICD1144,into=c("thrombotic.events.ICD10.144","thromobtic.events.ICD10.date.diagnosis.144"),sep="/")
df146<-separate(df145, thrombotic.events.ICD1145,into=c("thrombotic.events.ICD10.145","thromobtic.events.ICD10.date.diagnosis.145"),sep="/")
df147<-separate(df146, thrombotic.events.ICD1146,into=c("thrombotic.events.ICD10.146","thromobtic.events.ICD10.date.diagnosis.146"),sep="/")
df148<-separate(df147, thrombotic.events.ICD1147,into=c("thrombotic.events.ICD10.147","thromobtic.events.ICD10.date.diagnosis.147"),sep="/")
df149<-separate(df148, thrombotic.events.ICD1148,into=c("thrombotic.events.ICD10.148","thromobtic.events.ICD10.date.diagnosis.148"),sep="/")
df150<-separate(df149, thrombotic.events.ICD1149,into=c("thrombotic.events.ICD10.149","thromobtic.events.ICD10.date.diagnosis.149"),sep="/")
df151<-separate(df150, thrombotic.events.ICD1150,into=c("thrombotic.events.ICD10.150","thromobtic.events.ICD10.date.diagnosis.150"),sep="/")
df152<-separate(df151, thrombotic.events.ICD1151,into=c("thrombotic.events.ICD10.151","thromobtic.events.ICD10.date.diagnosis.151"),sep="/")
df153<-separate(df152, thrombotic.events.ICD1152,into=c("thrombotic.events.ICD10.152","thromobtic.events.ICD10.date.diagnosis.152"),sep="/")
df154<-separate(df153, thrombotic.events.ICD1153,into=c("thrombotic.events.ICD10.153","thromobtic.events.ICD10.date.diagnosis.153"),sep="/")
df155<-separate(df154, thrombotic.events.ICD1154,into=c("thrombotic.events.ICD10.154","thromobtic.events.ICD10.date.diagnosis.154"),sep="/")
df156<-separate(df155, thrombotic.events.ICD1155,into=c("thrombotic.events.ICD10.155","thromobtic.events.ICD10.date.diagnosis.155"),sep="/")
df157<-separate(df156, thrombotic.events.ICD1156,into=c("thrombotic.events.ICD10.156","thromobtic.events.ICD10.date.diagnosis.156"),sep="/")
df158<-separate(df157, thrombotic.events.ICD1157,into=c("thrombotic.events.ICD10.157","thromobtic.events.ICD10.date.diagnosis.157"),sep="/")
df159<-separate(df158, thrombotic.events.ICD1158,into=c("thrombotic.events.ICD10.158","thromobtic.events.ICD10.date.diagnosis.158"),sep="/")
df160<-separate(df159, thrombotic.events.ICD1159,into=c("thrombotic.events.ICD10.159","thromobtic.events.ICD10.date.diagnosis.159"),sep="/")
df161<-separate(df160, thrombotic.events.ICD1160,into=c("thrombotic.events.ICD10.160","thromobtic.events.ICD10.date.diagnosis.160"),sep="/")
df162<-separate(df161, thrombotic.events.ICD1161,into=c("thrombotic.events.ICD10.161","thromobtic.events.ICD10.date.diagnosis.161"),sep="/")
df163<-separate(df162, thrombotic.events.ICD1162,into=c("thrombotic.events.ICD10.162","thromobtic.events.ICD10.date.diagnosis.162"),sep="/")
df164<-separate(df163, thrombotic.events.ICD1163,into=c("thrombotic.events.ICD10.163","thromobtic.events.ICD10.date.diagnosis.163"),sep="/")
df165<-separate(df164, thrombotic.events.ICD1164,into=c("thrombotic.events.ICD10.164","thromobtic.events.ICD10.date.diagnosis.164"),sep="/")
df166<-separate(df165, thrombotic.events.ICD1165,into=c("thrombotic.events.ICD10.165","thromobtic.events.ICD10.date.diagnosis.165"),sep="/")
df167<-separate(df166, thrombotic.events.ICD1166,into=c("thrombotic.events.ICD10.166","thromobtic.events.ICD10.date.diagnosis.166"),sep="/")
df168<-separate(df167, thrombotic.events.ICD1167,into=c("thrombotic.events.ICD10.167","thromobtic.events.ICD10.date.diagnosis.167"),sep="/")
df169<-separate(df168, thrombotic.events.ICD1168,into=c("thrombotic.events.ICD10.168","thromobtic.events.ICD10.date.diagnosis.168"),sep="/")
df170<-separate(df169, thrombotic.events.ICD1169,into=c("thrombotic.events.ICD10.169","thromobtic.events.ICD10.date.diagnosis.169"),sep="/")
df171<-separate(df170, thrombotic.events.ICD1170,into=c("thrombotic.events.ICD10.170","thromobtic.events.ICD10.date.diagnosis.170"),sep="/")
df172<-separate(df171, thrombotic.events.ICD1171,into=c("thrombotic.events.ICD10.171","thromobtic.events.ICD10.date.diagnosis.171"),sep="/")
df173<-separate(df172, thrombotic.events.ICD1172,into=c("thrombotic.events.ICD10.172","thromobtic.events.ICD10.date.diagnosis.172"),sep="/")
df174<-separate(df173, thrombotic.events.ICD1173,into=c("thrombotic.events.ICD10.173","thromobtic.events.ICD10.date.diagnosis.173"),sep="/")
df175<-separate(df174, thrombotic.events.ICD1174,into=c("thrombotic.events.ICD10.174","thromobtic.events.ICD10.date.diagnosis.174"),sep="/")
df176<-separate(df175, thrombotic.events.ICD1175,into=c("thrombotic.events.ICD10.175","thromobtic.events.ICD10.date.diagnosis.175"),sep="/")
df177<-separate(df176, thrombotic.events.ICD1176,into=c("thrombotic.events.ICD10.176","thromobtic.events.ICD10.date.diagnosis.176"),sep="/")
df178<-separate(df177, thrombotic.events.ICD1177,into=c("thrombotic.events.ICD10.177","thromobtic.events.ICD10.date.diagnosis.177"),sep="/")
df179<-separate(df178, thrombotic.events.ICD1178,into=c("thrombotic.events.ICD10.178","thromobtic.events.ICD10.date.diagnosis.178"),sep="/")
df180<-separate(df179, thrombotic.events.ICD1179,into=c("thrombotic.events.ICD10.179","thromobtic.events.ICD10.date.diagnosis.179"),sep="/")
df181<-separate(df180, thrombotic.events.ICD1180,into=c("thrombotic.events.ICD10.180","thromobtic.events.ICD10.date.diagnosis.180"),sep="/")
df182<-separate(df181, thrombotic.events.ICD1181,into=c("thrombotic.events.ICD10.181","thromobtic.events.ICD10.date.diagnosis.181"),sep="/")
df183<-separate(df182, thrombotic.events.ICD1182,into=c("thrombotic.events.ICD10.182","thromobtic.events.ICD10.date.diagnosis.182"),sep="/")
df184<-separate(df183, thrombotic.events.ICD1183,into=c("thrombotic.events.ICD10.183","thromobtic.events.ICD10.date.diagnosis.183"),sep="/")
df185<-separate(df184, thrombotic.events.ICD1184,into=c("thrombotic.events.ICD10.184","thromobtic.events.ICD10.date.diagnosis.184"),sep="/")
df186<-separate(df185, thrombotic.events.ICD1185,into=c("thrombotic.events.ICD10.185","thromobtic.events.ICD10.date.diagnosis.185"),sep="/")
df187<-separate(df186, thrombotic.events.ICD1186,into=c("thrombotic.events.ICD10.186","thromobtic.events.ICD10.date.diagnosis.186"),sep="/")
df188<-separate(df187, thrombotic.events.ICD1187,into=c("thrombotic.events.ICD10.187","thromobtic.events.ICD10.date.diagnosis.187"),sep="/")
df189<-separate(df188, thrombotic.events.ICD1188,into=c("thrombotic.events.ICD10.188","thromobtic.events.ICD10.date.diagnosis.188"),sep="/")
df190<-separate(df189, thrombotic.events.ICD1189,into=c("thrombotic.events.ICD10.189","thromobtic.events.ICD10.date.diagnosis.189"),sep="/")
df191<-separate(df190, thrombotic.events.ICD1190,into=c("thrombotic.events.ICD10.190","thromobtic.events.ICD10.date.diagnosis.190"),sep="/")
df192<-separate(df191, thrombotic.events.ICD1191,into=c("thrombotic.events.ICD10.191","thromobtic.events.ICD10.date.diagnosis.191"),sep="/")
df193<-separate(df192, thrombotic.events.ICD1192,into=c("thrombotic.events.ICD10.192","thromobtic.events.ICD10.date.diagnosis.192"),sep="/")
df194<-separate(df193, thrombotic.events.ICD1193,into=c("thrombotic.events.ICD10.193","thromobtic.events.ICD10.date.diagnosis.193"),sep="/")
df195<-separate(df194, thrombotic.events.ICD1194,into=c("thrombotic.events.ICD10.194","thromobtic.events.ICD10.date.diagnosis.194"),sep="/")
df196<-separate(df195, thrombotic.events.ICD1195,into=c("thrombotic.events.ICD10.195","thromobtic.events.ICD10.date.diagnosis.195"),sep="/")
df197<-separate(df196, thrombotic.events.ICD1196,into=c("thrombotic.events.ICD10.196","thromobtic.events.ICD10.date.diagnosis.196"),sep="/")
df198<-separate(df197, thrombotic.events.ICD1197,into=c("thrombotic.events.ICD10.197","thromobtic.events.ICD10.date.diagnosis.197"),sep="/")
df199<-separate(df198, thrombotic.events.ICD1198,into=c("thrombotic.events.ICD10.198","thromobtic.events.ICD10.date.diagnosis.198"),sep="/")
df200<-separate(df199, thrombotic.events.ICD1199,into=c("thrombotic.events.ICD10.199","thromobtic.events.ICD10.date.diagnosis.199"),sep="/")
df201<-separate(df200, thrombotic.events.ICD1200,into=c("thrombotic.events.ICD10.200","thromobtic.events.ICD10.date.diagnosis.200"),sep="/")
df202<-separate(df201, thrombotic.events.ICD1201,into=c("thrombotic.events.ICD10.201","thromobtic.events.ICD10.date.diagnosis.201"),sep="/")
df203<-separate(df202, thrombotic.events.ICD1202,into=c("thrombotic.events.ICD10.202","thromobtic.events.ICD10.date.diagnosis.202"),sep="/")
df204<-separate(df203, thrombotic.events.ICD1203,into=c("thrombotic.events.ICD10.203","thromobtic.events.ICD10.date.diagnosis.203"),sep="/")
df205<-separate(df204, thrombotic.events.ICD1204,into=c("thrombotic.events.ICD10.204","thromobtic.events.ICD10.date.diagnosis.204"),sep="/")
df206<-separate(df205, thrombotic.events.ICD1205,into=c("thrombotic.events.ICD10.205","thromobtic.events.ICD10.date.diagnosis.205"),sep="/")
df207<-separate(df206, thrombotic.events.ICD1206,into=c("thrombotic.events.ICD10.206","thromobtic.events.ICD10.date.diagnosis.206"),sep="/")
df208<-separate(df207, thrombotic.events.ICD1207,into=c("thrombotic.events.ICD10.207","thromobtic.events.ICD10.date.diagnosis.207"),sep="/")
df209<-separate(df208, thrombotic.events.ICD1208,into=c("thrombotic.events.ICD10.208","thromobtic.events.ICD10.date.diagnosis.208"),sep="/")
df210<-separate(df209, thrombotic.events.ICD1209,into=c("thrombotic.events.ICD10.209","thromobtic.events.ICD10.date.diagnosis.209"),sep="/")
df211<-separate(df210, thrombotic.events.ICD1210,into=c("thrombotic.events.ICD10.210","thromobtic.events.ICD10.date.diagnosis.210"),sep="/")
df212<-separate(df211, thrombotic.events.ICD1211,into=c("thrombotic.events.ICD10.211","thromobtic.events.ICD10.date.diagnosis.211"),sep="/")
df213<-separate(df212, thrombotic.events.ICD1212,into=c("thrombotic.events.ICD10.212","thromobtic.events.ICD10.date.diagnosis.212"),sep="/")
df214<-separate(df213, thrombotic.events.ICD1213,into=c("thrombotic.events.ICD10.213","thromobtic.events.ICD10.date.diagnosis.213"),sep="/")


















df_split <- separate(df4, thrombotic.events.ICD105, into = c("thrombotic.events.ICD10.5", "thromobtic.events.ICD10.date.diagnosis.5"), sep = "/")

rm(list = c("df2", "df3", "df4"))
str(df, list.len=ncol(df))
str(df_split, list.len=ncol(df_split))

#Perform step 2 
df_split$PLTinitialdates <- as.Date(df_split$PLT_dates_initial)
date <- grepl("date", names(df_split))
df_split[,date] <-lapply(df_split[, date, drop=FALSE], as.Date)

#Step 3
df_split <- df_split %>% mutate(earliest_date = pmin(thromobtic.events.ICD10.date.diagnosis.1, na.rm =T))
df_split$PLTincident.flag <- ifelse(df_split$earliest_date >= df_split$PLTinitialdates,1,0) 
table(df_split$PLTincident.flag)

#Step 4 - Define controls
df_split$controls <- ifelse(
  is.na(df_split$thrombotic.events.ICD10.1) &
    is.na(df_split$thrombotic.events.ICD10.2) &
    is.na(df_split$thrombotic.events.ICD10.3), 
  1,
  0
)
table(df_split$controls)

#Step 5 - Participants who have a ICD10 of interest code diagnosed after PLT initial measurement date
# define incident cases (2=cases)
df_split$cases <- ifelse(df_split$PLTincident.flag ==1, 2, 0) # cases
table(df_split$cases)
#Make incident thrombotic outcome
df_split$incident_thrombotic_events <- NA
df_split$incident_thrombotic_events <- ifelse(df_split$controls==1, 1, ifelse(df_split$cases==2, 2, NA))
table(df_split$incident_thrombotic_events)

#Step 6 
res_final <- df_split[,c("projectID", "ieu", "PLT_initial_SD", "PLT_dates_initial", "incident_thrombotic_events")]
write.table(res_final, "UKB_PLT_initial_SD_ICD10_outcome", sep = " ", col.names=T,row.names=F,quote=F)
#OR
res_final <- df_split[,c("projectID", "ieu", "MPV_initial_SD", "MPVdates_initial", "incident_thrombotic_events")]
write.table(res_final, "UKB_MPV_initial_SD_ICD10_outcome", sep = " ", col.names=T,row.names=F,quote=F)
