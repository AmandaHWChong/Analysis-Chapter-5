###Linking ICD10 codes of interest to ICD10 dates###
#The input will be used to perform the observational and one-sample MR analyses restricted on ICD10 cases of interest that have occurred after the platelet measurements to minimise reverse causation.

##Prepare ICD10 codes of interest 

#Read in relevant packages
library(dplyr)

#Read in relevant data
dat <- read.table("output_extracted_41270_ICD10_41280_ICD10dates.tsv", header = T)

#All ICD10 data
allICD10 <- unlist(dat %>% select(starts_with("f.41270.")), use.names=F) #this searches your columns for all unique values and lists them
allICD10<-allICD10[!is.na(allICD10)] # removes NA
allICD10<-allICD10[!duplicated(allICD10)] # removes duplicate ICD10 codes

#Subset for only ICD10 codes of interest 
toMatch <- c("I210", "I211", "I212", "I213", "I214", "I219", "I801", "I802", "I260", "I269") #ICD10 codes for acute MI, DVT and PE
thrombotic_events_ICD10 <- unique(grep(paste(toMatch,collapse="|"), allICD10, value=TRUE))
table(thrombotic_events_ICD10) #Check the codes of interest that were matched
